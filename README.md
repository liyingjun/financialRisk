# 金融风险计算脚本

## 安装基础环境

1. 下载并安装最新版本的Python: https://www.python.org/downloads/
2. 安装pip：https://pip.pypa.io/en/stable/installation/
3. 点击链接下载项目到本地：https://github.com/liyingjun/financialRisk/archive/refs/heads/main.zip
4. 解压代码，进入代码目录安装依赖：`pip install --index-url https://mirrors.aliyun.com/pypi/simple --trusted-host mirrors.aliyun.com -r requirements.txt`

## 脚本使用介绍

### calculate_VaR.py

以10万人民币本金出发，选择一段时间某公司股票收盘价数据,用历史模拟法、参数法和蒙特卡罗模拟法计算股票在未来一个日度5%的VaR:

```
usage: calculate_VaR [-h] [-c CAPITAL] [-l CONFIDENCE_LEVEL] code start end

指定本金，选择一段时间某公司股票收盘价数据，用历史模拟法、参数法和蒙特卡罗模拟法计算股票在未来一个日度指定置信水平的VaR

positional arguments:
  code                  股票代码，深交所以SZ开头，上交所以SH开头，例如：SZ000009
  start                 数据开始日期，例如：20200729
  end                   数据结束日期，例如：20230728

options:
  -h, --help            show this help message and exit
  -c CAPITAL, --capital CAPITAL
                        本金，默认为100000元
  -l CONFIDENCE_LEVEL, --confidence-level CONFIDENCE_LEVEL
                        置信水平，默认为0.95
```

使用示例：

```
python3 calculate_VaR.py SZ000009 20220729 20230728
```

输出：

```
历史数据来源https://quote.eastmoney.com/concept/sz000009.html?from=classic

VaR计算中（股票代码：SZ000009），其中本金: 100000元，置信水平: 0.95，持有期为1天

- 使用历史模拟法计算VaR为：3519.41元
- 使用参数法计算VaR为：3608.37元
- 使用蒙特卡罗模拟法计算VaR为：3648.19元
```

### calculate_Z_KMV.py

获取某上市公司在指定时间段的财务数据以及股票收盘价数据，计算其最近三年的Z评分和
使用KMV模型计算其1年期违约概率

```
usage: calculate_Z_KMV [-h] [-c {1,2}] code start end

获取某上市公司在指定时间段的财务数据以及股票收盘价数据，计算其最近三年的Z评分和使用KMV模型计算其1年期违约概率

positional arguments:
  code                  股票代码，深交所以SZ开头，上交所以SH开头，例如：SZ000009
  start                 数据开始日期，例如：20200729
  end                   数据结束日期，例如：20230728

options:
  -h, --help            show this help message and exit
  -c {1,2}, --category {1,2}
                        上市公司种类，1表示制造业，2表示非制造业，默认为制造业
```

使用示例:

- 制造业:

    ```
    python3 calculate_Z_KMV.py SH600519 20200729 20230728
    ```

    输出：

    ```
    === Z评分计算中...
    数据来源：https://emweb.securities.eastmoney.com/PC_HSF10/NewFinanceAnalysis/Index?type=web&code=sh600519#lrb-0

    - 贵州茅台（股票代码：SH600519）2022的Z评分为：5.987720225097479
    - 贵州茅台（股票代码：SH600519）2021的Z评分为：5.210991635722403
    - 贵州茅台（股票代码：SH600519）2020的Z评分为：5.514636976685933

    === 违约概率计算中（KMV模型）...
    历史数据来源https://quote.eastmoney.com/concept/sh600519.html?from=classic

    - 贵州茅台（股票代码：SH600519）2022年：
     - 1年期国债平均收益率为：0.019781119521912353
     - 股权年化波动率：0.28677574828335695
     - 股权市值：2169454000000.0，资产市值：2217722580069.712，波动率：0.28053718354229656，违约点：49232892769.774994，负债比率：0.19420971679667906
     - 公式1：违约距离：3.485456847405317
     - 公式1：违约概率（KMV模型）为：0.02456487294524857%
     - 公式2：违约距离：13.43045691357166
     - 公式2：违约概率（KMV模型）为：2.0046503795748698e-39%

    - 贵州茅台（股票代码：SH600519）2021年：
     - 1年期国债平均收益率为：0.023972330677290835
     - 股权年化波动率：0.3582949158019302
     - 股权市值：2575205000000.0，资产市值：2631892113908.5894，波动率：0.3505815057786375，违约点：58062455354.69，负债比率：0.228126739768969
     - 公式1：违约距离：2.78947655877488
     - 公式1：违约概率（KMV模型）为：0.2639665902123894%
     - 公式2：违约距离：10.704007071349054
     - 公式2：违约概率（KMV模型）为：4.873498153175268e-25%

    - 贵州茅台（股票代码：SH600519）2020年：
     - 1年期国债平均收益率为：0.02181208032128514
     - 股权年化波动率：0.2744808416453409
     - 股权市值：2509883000000.0，资产市值：2554571931630.9937，波动率：0.2696806766113725，违约点：45674398669.564995，负债比率：0.21403947581390065
     - 公式1：违约距离：3.6417905050290575
     - 公式1：违约概率（KMV模型）为：0.013537418360133401%
     - 公式2：违约距离：14.795406962165664
     - 公式2：违约概率（KMV模型）为：7.841644402603151e-48%
    ```

- 非制造业:

    ```
    python3 calculate_Z_KMV.py --category 2 SH600536 20200729 20230728
    ```

    输出：

    ```
    === Z评分计算中...
    数据来源：https://emweb.securities.eastmoney.com/PC_HSF10/NewFinanceAnalysis/Index?type=web&code=sh600536#lrb-0

    - 中国软件（股票代码：SH600536）2022的Z评分为：1.9862590134182563
    - 中国软件（股票代码：SH600536）2021的Z评分为：2.275817165241086
    - 中国软件（股票代码：SH600536）2020的Z评分为：2.422785003802755

    === 违约概率计算中（KMV模型）...
    历史数据来源https://quote.eastmoney.com/concept/sh600536.html?from=classic

    - 中国软件（股票代码：SH600536）2022年：
     - 1年期国债平均收益率为：0.019781119521912353
     - 股权年化波动率：0.5707264907070475
     - 股权市值：38497000000.0，资产市值：44661271625.67493，波动率：0.4919580521076281，违约点：6287473529.455，负债比率：0.6535289444382193
     - 公式1：违约距离：1.7465283053435312
     - 公式1：违约概率（KMV模型）为：4.035959649917077%
     - 公式2：违约距离：3.7425554554323806
     - 公式2：违约概率（KMV模型）为：0.00910791579869263%

    - 中国软件（股票代码：SH600536）2021年：
     - 1年期国债平均收益率为：0.023972330677290835
     - 股权年化波动率：0.44026584926837115
     - 股权市值：24694000000.0，资产市值：31518730774.290833，波动率：0.34493607800888654，违约点：6990317090.145，负债比率：0.6966403750683925
     - 公式1：违约距离：2.25611961071544
     - 公式1：违约概率（KMV模型）为：1.2031570643255254%
     - 公式2：违约距离：4.187704374459786
     - 公式2：违约概率（KMV模型）为：0.001408951168018449%

    - 中国软件（股票代码：SH600536）2020年：
     - 1年期国债平均收益率为：0.02181208032128514
     - 股权年化波动率：0.5669199731500147
     - 股权市值：38952000000.0，资产市值：44447356610.22041，波动率：0.49682974294535626，违约点：5616560150.955，负债比率：0.668132497499495
     - 公式1：违约距离：1.7584206438329335
     - 公式1：违约概率（KMV模型）为：3.933798156097079%
     - 公式2：违约距离：3.915737030347669
     - 公式2：违约概率（KMV模型）为：0.004506422295436858%
    ```
